<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./querries.css">
    <link rel="stylesheet" href="./ediBlog.css">
    <script src="https://cdn.tiny.cloud/1/afzhk8pfp2qe78avkxfbb3r0sasvj5381yryq39rlv6dx2zt/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <title>Admin Page</title>
</head>

<body>
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="title">BA Admin Page</span>
                    </a>
                </li>
                <li>
                    <a href="../admin-panel.html">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="title">Home</span>
                    </a>
                </li>
                <li>
                    <a href="./pages/querries.html">
                        <span class="icon"><ion-icon name="mail-unread-outline"></ion-icon></span>
                        <span class="title">Manage Querries</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
                        <span class="title">User Profile</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><ion-icon name="log-out-outline"></ion-icon></ion-icon></span>
                        <span class="title">SignOut</span>
                    </a>
                </li>
            </ul>
        </div>
        <!--main-->
        <div class="main">
            <div class="topbar">
                <div class="toggle">
                    <!-- <ion-icon name="menu-outline"></ion-icon> -->
                </div>
                <div class="search">
                    <label>
                        <input type="text" placeholder="search area">
                        <ion-icon name="" search-outline></ion-icon>
                    </label>
                </div>

                <p id="qwerty"></p>
                <div class="user">
                    <img src="../imgs/avatar.svg" alt="">
                </div>
            </div>
    <div class="form-container">
        <form class="form" name="formValidate" onsubmit=" event.preventDefault()">
            <div class="inputBox">
                <input type="text" id="titlee" placeholder="add your blog title here">
                <div class="error"></div>
            </div>
            <div class="inputBox">
                <!-- <input type="text" id="author" placeholder="add your blog author here"> -->
                <div class="error"></div>
            </div>
            <div class="inputBox">
                <input type="text" id="content" placeholder="add your blog author here">
                <!-- <textarea name="" id="content" cols="50" rows="10"></textarea> -->
                <textarea id="mytextarea" cols="70" rows="30"></textarea>

    <!--
      Sourcing the `tinymce-webcomponent` from jsDelivr,
      which sources TinyMCE from the Tiny Cloud.
    -->
    
                <div class="error"></div>
            </div>
            <div class="error"></div>
            <div class="inputBox">
                <!-- <div id="editor" style=height:200px></div> -->
                <input type="file" id="image">
                <div class="error"></div>
            </div>
            <div class="inputBox">
                <input type="submit" id="submit" name="" value="send" onclick="updateBlog()">
            </div>
        </form>
    <script>
        // let title = document.getElementById
        // var quill = new Quill('#editor', {
        //   theme: 'snow',
        //   modules: {
        //  'toolbar': { container: '#toolbar' },
        //  'image-tooltip': true,
        // 'link-tooltip': true
        //  }
        // });
//         var quill = new Quill('#editor', {
//         modules: {
//          'toolbar': { container: '#toolbar' },
//          'image-tooltip': true,
//         'link-tooltip': true
//          },
//         theme: 'snow'
// });
function viewBlog(){
    let token = localStorage.getItem("tempUser")
    let contentB =document.getElementById("mytextarea")
    let id;
    var parts = window.location.search.substr(1).split("&");
    var title = document.getElementById("titlee")
    var content = document.getElementById("content")
    // var author = document.getElementById("author")
    var pic = document.getElementById("image");
    id = parts[0];
    const dbData = {
        method:'GET',
        headers:{
            'authorization': `Bearer ${token}`
        },
    }
    fetch(`https://my-brand-production-05a1.up.railway.app/api/v1/blogs/${id}`,dbData)
    .then(async(res)=>{
        tinymce.init({
            selector: '#mytextarea'
        });
        const data = await res.json()
        contentB.value = tinymce.activeEditor.setContent(data.blogContent);
        console.log(contentB);
        title.value = data.blogTitle
        content.value = data.author
        pic.value = data.photo
        console.log(data.photo);
    })
}

        async function updateBlog(){
            let token = localStorage.getItem("tempUser")
            var title = document.getElementById("titlee").value;
            // var content = document.getElementById("content").value;
            var author = document.getElementById("content").value;
            // let contentB =document.getElementById("mytextarea")
            var pic = document.getElementById("image");
            let id;
            var parts = window.location.search.substr(1).split("&");
            id = parts[0];
            // const data = {
                //     blogTitle: title.value,
                //     blogContent:content.value,
                //     author: author.value,
                //     photo: pic.value
                const formData = new FormData();
                const contentB =await tinymce.activeEditor.getContent();
                formData.append('image', pic.files[0]); // fileInputElement is an input element with type "file"
                formData.append('blogTitle', title);
                formData.append('blogContent', contentB);
                formData.append('author', author);
                // }
                console.log(contentB)
            const dbData = {
                method:"PATCH",
                headers:{
                    'authorization': `Bearer ${token}`
                },
                body:formData
            }
            console.log(dbData)
            await fetch(`https://my-brand-production-05a1.up.railway.app/api/v1/blogs/${id}`,dbData)
            .then(async(res)=>{
                const data = await res.json()
                console.log(data);
            })
        }
        viewBlog()
        
      </script>
      <script src="../scripts.js"></script>
</body>
</html>













<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="../images/icon.png" >
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet"> 
    <script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>  
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>
    <nav>
        <span onclick="toggleDashNav()"><img src="../images/menu2.png" alt="menu"></span>
        <div class="logo"><img src="../images/ED.png" alt=""></div>
        <div class="links" id="wowM">
            <a href="../index.html">Portfolio</a>
            <a href="../contacts.html">Contacts</a>
            <a href="../blog.html">Blogs</a>
            <button onclick="logOut()">Log Out</button>
        </div>
        <div class="dp" onclick="displayWow()">
            <img src="../images/dp.jpg" alt="dp" >
        </div>
    </nav>
    <div id="popcontact" onclick="rehide()">
        Blog Posted
    </div>
    <div class="dash-container">
        <div id="dash-nav">
            <a href="./dashboard.html">Dashboard</a>
            <a href="./new.html">New Blog</a>
            <a href="./messages.html">Messages</a>
            <a href="./settings.html">Settings</a>
            
        </div>
        <div class="new">
            <div class="new-box" id="imgreceiver">
                <div class="title">Edit Blog </div>
                <form onsubmit="event.preventDefault(); editBlog(x)" id="frm">
                    <label for="title">Title</label>
                    <input type="text" name="title" id="title">
                    <label for="file">Add Photo</label>
                    <input type="file" name="image" id="image">
                    <div class="imageholder" id="imageholder">

                    </div>
                    <label for="content">Blog Content</label>
                    <div name="content" id="content" cols="30" rows="10"></div>
                    <button style="background: green;">EDIT BLOG</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        let Bloge = JSON.parse(window.localStorage.getItem("Blogs"))
        let x;
        var parts = window.location.search.substr(1).split("&");
        var m = {};
        for (var i = 0; i < parts.length; i++) {
            var temp = parts[i].split("=");
            
            m[decodeURIComponent(temp[0])] = decodeURIComponent(temp[1]);
            
        }
        x = m['id']
        var idx = Bloge.findIndex(function(item, i){
            return item._id == x
        });
        function showEdit(){
            let Bloge = JSON.parse(window.localStorage.getItem("Blogs"))
            document.getElementById("title").value = Bloge[idx].title
            document.getElementById("content").innerHTML = Bloge[idx].content
            const img = new Image()
            img.src = Bloge[idx].image
            img.classList.add("insertedImage")
            document.getElementById("imageholder").appendChild(img)
        }
        window.onload = showEdit()
    </script>
    <script>
        fileEl = document.getElementById('image')
        const h = document.getElementById("imageholder")
        fileEl.addEventListener('change', () => {
            const fr = new FileReader();
            fr.readAsDataURL(fileEl.files[0]);
            fr.addEventListener('load', () => {
                url = fr.result;
                const imge = new Image()
                imge.src = url
                imge.classList.add("insertedImage")
                let m = document.querySelector("#imgreceiver")
                window.localStorage.setItem("tempImage", url)
                h.appendChild(imge)
            })
        }) 
    </script>
    
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="./quill.js"></script>
    <script src="../script.js" ></script>
    <script>
        window.onload = che()
    </script>
</body>
</html> -->